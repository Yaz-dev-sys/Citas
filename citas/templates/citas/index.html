<!-- templates/inicio/index.html -->
{% extends 'base.html' %}

{% load static %}

{% block title %}Sistema de Citas{% endblock %}

{% block extra_css %}
<style>
   /* Variables CSS con colores institucionales de Atizapán de Zaragoza */
:root {
    /* Colores institucionales Atizapán */
    --color-primary: #4d4383;
    --color-secondary: #6767a5;
    --color-accent-1: #56858d;
    --color-accent-2: #79b0cc;
    --color-accent-3: #b64f80;
    --color-neutral: #585958;
    
    /* Variaciones de colores primarios */
    --color-primary-light: rgba(77, 67, 131, 0.1);
    --color-primary-medium: rgba(77, 67, 131, 0.7);
    --color-primary-dark: #3a2f5c;
    
    /* Gradientes institucionales */
    --gradient-primary: linear-gradient(140deg, var(--color-primary) 0%, var(--color-accent-2) 100%);
    --gradient-secondary: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-accent-2) 0.1);
    --gradient-accent: linear-gradient(140deg, var(--color-accent-3) 0%, var(--color-accent-2) 100%);
}

/* Estilos específicos para el sistema de citas */
.citas-hero {
    background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(121, 176, 204, 0.1) 100%);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 50px;
    text-align: center;
    border: 2px solid rgba(121, 176, 204, 0.2);
}

.citas-title {
    color: var(--color-primary);
    font-size: 3rem;
    margin-bottom: 15px;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(77, 67, 131, 0.1);
}

.citas-subtitle {
    color: var(--color-primary-dark);
    font-size: 1.5rem;
    margin-bottom: 30px;
    font-weight: 400;
}

.pasos-container {
    display: flex;
    justify-content: space-around;
    margin: 50px 0;
    flex-wrap: wrap;
}

.paso-item {
    flex: 0 0 250px;
    text-align: center;
    margin: 15px;
    position: relative;
}

.paso-numero {
    background: var(--gradient-primary);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 1.5rem;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(77, 67, 131, 0.3);
}

.paso-icono {
    font-size: 2.5rem;
    color: var(--color-primary);
    margin-bottom: 15px;
}

.paso-titulo {
    color: var(--color-accent-1);
    font-size: 1.3rem;
    margin-bottom: 10px;
    font-weight: 600;
}

.paso-descripcion {
    color: var(--color-neutral);
}

.areas-citas {
    margin-top: 60px;
}

/* ESTILOS PARA LAS ÁREAS - OPTIMIZADOS CON COLORES INSTITUCIONALES */
.areas-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 30px;
    margin: 40px 0;
}

.cita-card {
    background: transparent;
    border-radius: 15px;
    padding: 0;
    margin-bottom: 0;
    border: none;
    box-shadow: none;
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
    display: block;
    text-decoration: none;
    will-change: transform;
    backface-visibility: hidden;
}

.cita-card:hover {
    transform: scale(1.05);
    text-decoration: none;
}

.cita-card-header {
    display: block;
    margin: 0;
    padding: 0;
    width: 100%;
}

.cita-card-icon {
    width: 100%;
    height: auto;
    margin: 0;
    border-radius: 15px;
    object-fit: cover;
    transition: box-shadow 0.3s ease;
    box-shadow: 0 5px 15px rgba(77, 67, 131, 0.15);
    display: block;
}

.cita-card:hover .cita-card-icon {
    box-shadow: 0 8px 25px rgba(121, 176, 204, 0.25);
}

/* ESTILOS ESPECÍFICOS PARA EL FORMULARIO DE DESARROLLO SOCIAL */
.cita-card-wrapper {
    display: block;
    width: 100%;
    position: relative;
}

.cita-card-form {
    display: block;
    margin: 0;
    padding: 0;
    border: none;
    background: none;
    width: 100%;
}

.cita-card-form-button {
    all: unset;
    display: block;
    width: 100%;
    cursor: pointer;
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    border-radius: 15px;
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
    box-sizing: border-box;
    will-change: transform;
    backface-visibility: hidden;
}

.cita-card-form-button:hover {
    transform: scale(1.05);
}

.cita-card-form-button:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}

.cita-card-form-button:active {
    transform: scale(0.98);
}

.cita-card-form-button .cita-card-header {
    display: block;
    margin: 0;
    padding: 0;
    width: 100%;
}

.cita-card-form-button .cita-card-icon {
    width: 100%;
    height: auto;
    margin: 0;
    border-radius: 15px;
    object-fit: cover;
    transition: box-shadow 0.3s ease;
    box-shadow: 0 5px 15px rgba(77, 67, 131, 0.15);
    display: block;
}

.cita-card-form-button:hover .cita-card-icon {
    box-shadow: 0 8px 25px rgba(121, 176, 204, 0.25);
}

/* Botones de consulta de citas con colores institucionales */
.cita-card-button {
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 12px 25px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 4px 15px rgba(77, 67, 131, 0.3);
}

.cita-card-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(77, 67, 131, 0.4);
    text-decoration: none;
    color: white;
}

/* Responsive */
@media (max-width: 768px) {
    .areas-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
    }
    
    .pasos-container {
        flex-direction: column;
        align-items: center;
    }
    
    .paso-item {
        margin-bottom: 30px;
    }
    
    .citas-title {
        font-size: 2.2rem;
    }
    
    .citas-subtitle {
        font-size: 1.2rem;
    }
}

@media (max-width: 480px) {
    .areas-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}

/* NUEVA SECCIÓN DE CONSULTA MEJORADA CON COLORES INSTITUCIONALES */
.consulta-citas-section {
    background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(121, 176, 204, 0.05) 100%);
    border-radius: 25px;
    padding: 50px 30px;
    margin: 60px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 2px solid rgba(121, 176, 204, 0.2);
}

.consulta-citas-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, var(--color-primary-light) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
    pointer-events: none;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.consulta-title {
    color: var(--color-primary);
    font-size: 2.5rem;
    margin-bottom: 20px;
    font-weight: 600;
    position: relative;
    z-index: 2;
    text-shadow: 1px 1px 2px rgba(77, 67, 131, 0.1);
}

.consulta-description {
    font-size: 1.3rem;
    color: var(--color-neutral);
    margin-bottom: 40px;
    line-height: 1.6;
    position: relative;
    z-index: 2;
}

.consulta-buttons-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    position: relative;
    z-index: 2;
}

.consulta-button {
    background: linear-gradient(140deg, var(--color-accent-1) 0%, var(--color-accent-2) 100%);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 18px 35px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.4s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 8px 25px rgba(86, 133, 141, 0.3);
    position: relative;
    overflow: hidden;
}

.consulta-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.consulta-button:hover::before {
    left: 100%;
}

.consulta-button:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 35px rgba(86, 133, 141, 0.4);
    text-decoration: none;
    color: white;
}

.consulta-button:active {
    transform: translateY(-2px) scale(1.02);
}

.consulta-button i {
    font-size: 1.3rem;
    transition: transform 0.3s ease;
}

.consulta-button:hover i {
    transform: scale(1.2);
}

/* MODAL STYLES CON COLORES INSTITUCIONALES */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(77, 67, 131, 0.6);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: white;
    border-radius: 20px;
    padding: 40px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    transform: scale(0.7) translateY(50px);
    transition: all 0.3s ease;
    box-shadow: 0 20px 60px rgba(77, 67, 131, 0.3);
    border: 2px solid rgba(121, 176, 204, 0.2);
}

.modal-overlay.active .modal-container {
    transform: scale(1) translateY(0);
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    font-size: 24px;
    color: #999;
    cursor: pointer;
    transition: color 0.3s ease;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: var(--color-primary);
}

.modal-title {
    color: var(--color-primary);
    font-size: 2rem;
    margin-bottom: 10px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 15px;
}

.modal-subtitle {
    color: var(--color-neutral);
    font-size: 1.1rem;
    margin-bottom: 30px;
    line-height: 1.5;
}

.form-group {
    margin-bottom: 25px;
}

.form-label {
    display: block;
    color: var(--color-primary);
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 1.1rem;
}

.form-input {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    background: #f9f9f9;
    box-sizing: border-box;
}

.form-input:focus {
    outline: none;
    border-color: var(--color-primary);
    background: white;
    box-shadow: 0 0 0 3px var(--color-primary-light);
}

.form-buttons {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    margin-top: 30px;
    flex-wrap: wrap;
}

.btn-secondary {
    background: #f5f5f5;
    color: var(--color-neutral);
    border: 2px solid #ddd;
    border-radius: 12px;
    padding: 12px 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: #e0e0e0;
    border-color: var(--color-neutral);
}

.btn-primary {
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 12px 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(77, 67, 131, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(77, 67, 131, 0.4);
}

.btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* ESTILOS PARA EL BUSCADOR CON COLORES INSTITUCIONALES */
.search-container {
    position: relative;
    max-width: 600px;
    margin: 0 auto;
    z-index: 100;
}

.search-bar {
    position: relative;
    display: flex;
    align-items: center;
    background: white;
    border-radius: 50px;
    box-shadow: 0 8px 30px rgba(77, 67, 131, 0.15);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.search-bar:focus-within {
    border-color: var(--color-primary);
    box-shadow: 0 8px 30px rgba(77, 67, 131, 0.25);
    transform: translateY(-2px);
}

.search-input {
    flex: 1;
    border: none;
    padding: 18px 25px;
    font-size: 1.1rem;
    background: transparent;
    color: #333;
    outline: none;
}

.search-input::placeholder {
    color: #999;
    font-weight: 400;
}

.search-btn {
    background: var(--gradient-primary);
    border: none;
    padding: 18px 25px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.search-btn:hover {
    background: linear-gradient(140deg, var(--color-primary-dark) 0%, var(--color-accent-1) 100%);
    transform: scale(1.05);
}

.search-loading {
    position: absolute;
    right: 70px;
    color: var(--color-primary);
    font-size: 1rem;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* RESULTADOS DE BÚSQUEDA CON COLORES INSTITUCIONALES */
.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(77, 67, 131, 0.2);
    margin-top: 10px;
    max-height: 400px;
    overflow: hidden;
    border: 2px solid rgba(121, 176, 204, 0.2);
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.search-results-header {
    padding: 15px 20px;
    background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(121, 176, 204, 0.05) 100%);
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.results-count {
    font-weight: 600;
    color: var(--color-primary);
    font-size: 0.9rem;
}

.close-search {
    background: none;
    border: none;
    color: #999;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.3s ease;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-search:hover {
    background: #f5f5f5;
    color: var(--color-primary);
}

.search-results-content {
    max-height: 350px;
    overflow-y: auto;
}

/* ELEMENTOS DE RESULTADO CON COLORES INSTITUCIONALES */
.search-result-item {
    padding: 15px 20px;
    border-bottom: 1px solid #f5f5f5;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
}

.search-result-item:hover {
    background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(121, 176, 204, 0.03) 100%);
    transform: translateX(5px);
}

.search-result-item:last-child {
    border-bottom: none;
}

.result-title {
    font-weight: 600;
    color: #333;
    font-size: 1rem;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.result-area {
    color: var(--color-primary);
    font-size: 0.85rem;
    font-weight: 500;
    background: var(--color-primary-light);
    padding: 2px 8px;
    border-radius: 12px;
    display: inline-block;
}

.result-description {
    color: var(--color-neutral);
    font-size: 0.9rem;
    line-height: 1.4;
    margin-top: 5px;
}

.result-meta {
    display: flex;
    gap: 15px;
    margin-top: 8px;
    font-size: 0.8rem;
    color: #888;
}

.result-cost {
    display: flex;
    align-items: center;
    gap: 4px;
}

.result-time {
    display: flex;
    align-items: center;
    gap: 4px;
}

/* MENSAJE SIN RESULTADOS */
.no-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(77, 67, 131, 0.15);
    margin-top: 10px;
    padding: 40px 20px;
    text-align: center;
    border: 2px solid rgba(121, 176, 204, 0.2);
    animation: slideDown 0.3s ease-out;
}

.no-results i {
    font-size: 3rem;
    color: #ddd;
    margin-bottom: 15px;
}

.no-results p {
    color: var(--color-neutral);
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.no-results small {
    color: #999;
    font-size: 0.9rem;
}

/* RESALTADO DE TEXTO COINCIDENTE CON COLORES INSTITUCIONALES */
.highlight {
    background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(121, 176, 204, 0.2) 100%);
    color: var(--color-primary);
    font-weight: 600;
    padding: 1px 2px;
    border-radius: 3px;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .search-container {
        max-width: 100%;
        margin: 0 10px;
    }
    
    .search-input {
        padding: 15px 20px;
        font-size: 1rem;
    }
    
    .search-btn {
        padding: 15px 20px;
    }
    
    .search-results {
        margin-top: 5px;
    }
    
    .result-meta {
        flex-direction: column;
        gap: 5px;
    }
    
    .consulta-buttons-container {
        flex-direction: column;
        align-items: center;
    }
    
    .consulta-button {
        width: 100%;
        max-width: 300px;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .search-input {
        padding: 12px 15px;
        font-size: 0.95rem;
    }
    
    .search-btn {
        padding: 12px 15px;
    }
    
    .search-result-item {
        padding: 12px 15px;
    }
    
    .result-title {
        font-size: 0.95rem;
    }
    
    .citas-hero {
        padding: 25px 20px;
    }
    
    .consulta-citas-section {
        padding: 30px 20px;
    }
}

/* SCROLLBAR PERSONALIZADA CON COLORES INSTITUCIONALES */
.search-results-content::-webkit-scrollbar {
    width: 6px;
}

.search-results-content::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.search-results-content::-webkit-scrollbar-thumb {
    background: var(--gradient-primary);
    border-radius: 3px;
}

.search-results-content::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(140deg, var(--color-primary-dark) 0%, var(--color-accent-1) 100%);
}

/* Animaciones adicionales */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.citas-hero,
.consulta-citas-section,
.areas-grid {
    animation: fadeInUp 0.8s ease-out;
}

/* Estados de focus mejorados para accesibilidad */
.cita-card:focus,
.consulta-button:focus,
.btn-primary:focus,
.btn-secondary:focus {
    outline: 3px solid var(--color-accent-2);
    outline-offset: 2px;
}

/* Hover states adicionales */
.paso-numero:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(77, 67, 131, 0.4);
}
</style>
{% endblock %}

{% block content %}
    <!-- Hero section -->
    <div class="citas-hero">
        <h1 class="citas-title">Sistema de Citas en Línea</h1>
        <p class="citas-subtitle">Agenda tu cita de manera rápida y sencilla desde la comodidad de tu hogar</p>
        <!-- 
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Buscar trámite o servicio...">
            <button class="search-btn">
                <i class="fas fa-search"></i>
            </button>
        </div>
        -->

        <div class="search-container">
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar trámite o servicio..." autocomplete="off">
                <button class="search-btn" type="button">
                    <i class="fas fa-search"></i>
                </button>
                <div class="search-loading" id="searchLoading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </div>
            
            <!-- Resultados del buscador -->
            <div id="searchResults" class="search-results" style="display: none;">
                <div class="search-results-header">
                    <span class="results-count">Resultados encontrados</span>
                    <button class="close-search" id="closeSearch">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="search-results-content" id="searchResultsContent">
                    <!-- Aquí se cargarán los resultados dinámicamente -->
                </div>
            </div>
            
            <!-- Mensaje cuando no hay resultados -->
            <div id="noResults" class="no-results" style="display: none;">
                <i class="fas fa-search-minus"></i>
                <p>No se encontraron trámites que coincidan con tu búsqueda</p>
                <small>Intenta con otros términos o revisa las áreas disponibles</small>
            </div>
        </div>
    </div>

    <!-- Pasos para agendar -->
    <div class="creative-separator">
        <div class="wave-separator"></div>
        <h2 class="separator-text">¿Cómo agendar tu cita?</h2>
    </div>
    
    <div class="pasos-container">
        <!--
        <div class="paso-item">
            <div class="paso-numero">1</div>
            <div class="paso-icono"><i class="fas fa-search"></i></div>
            <h3 class="paso-titulo">Busca tu trámite</h3>
            <p class="paso-descripcion">Encuentra el servicio o trámite que necesitas realizar</p>
        </div>
        -->
        <div class="paso-item">
            <div class="paso-numero">1</div>
            <div class="paso-icono"><i class="far fa-calendar-alt"></i></div>
            <h3 class="paso-titulo">Selecciona fecha</h3>
            <p class="paso-descripcion">Elige el día y hora que mejor se adapte a tus necesidades</p>
        </div>
        
        <div class="paso-item">
            <div class="paso-numero">2</div>
            <div class="paso-icono"><i class="far fa-user"></i></div>
            <h3 class="paso-titulo">Registra tus datos</h3>
            <p class="paso-descripcion">Proporciona la información requerida para tu cita</p>
        </div>
        
        <div class="paso-item">
            <div class="paso-numero">3</div>
            <div class="paso-icono"><i class="fas fa-check-circle"></i></div>
            <h3 class="paso-titulo">Confirma tu cita</h3>
            <p class="paso-descripcion">Recibe tu comprobante por correo electrónico</p>
        </div>
    </div>

    <!-- Áreas para agendar citas -->
    <div class="creative-separator">
        <div class="wave-separator"></div>
        <h2 class="separator-text">Selecciona el área para tu cita</h2>
    </div>
    
    <div class="areas-grid">
        <!-- Desarrollo Económico 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/3_DESARROLLO_ECONÓMICO.png' %}" alt="Desarrollo Económico" class="cita-card-icon">
            </div>
        </a>
        -->
        
        <!-- Desarrollo Social - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="1">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/8_DESARROLLO_SOCIAL.png' %}" alt="Desarrollo Social" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Servicios Públicos - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="2">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/10_SERVICIOS_PUBLICOS.png' %}" alt="Servicios Públicos" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Protección Civil - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="3">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/11_PROTECCION_CIVIL.png' %}" alt="Protección Civil" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Dirección Administración - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="4">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/12_DIRECCION_ADMINISTRACION.png' %}" alt="Dirección Administración" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Ordenamiento Territorial - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="5">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/16_ORDENAMIENTO_TERRITORIAL.png' %}" alt="Ordenamiento Territorial" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Contraloria 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/1_CONTRALORÍA-MUNICIPAL.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a>
        -->
        
        <!-- Derechos humanos - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="6">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/2_DERECHOS_HUMANOS.png' %}" alt="Derechos Humanos" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- Atencion Ciudana 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/4_COORDINACIÓN_ATENCIÓN_CIUDADANA.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a>     
        -->
        
        <!-- Seguridad publica y seguridad vial 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/5_SEGURIDAD_PÚBLICA-Y-SEGURIDAD_VIAL.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a>  
        -->
        
        <!-- Mejora regulatoria 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/6_COORDINACIÓN_GENERAL_MUNICIPAL_DE_MEJORA_REGULATORIA.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a>  
        -->
        
        <!-- dif 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/7_DIF.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a>  
        -->
        
        <!-- 13_DIRECCIÓN_DELA_JUVENTUD.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="7">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/13_DIRECCION_DELA_JUVENTUD.png' %}" alt="Dirección de la Juventud" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 9_JURIDÍCO-Y-CONSULTIVO.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="8">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/9_JURIDICO-Y-CONSULTIVO.png' %}" alt="Jurídico y Consultivo" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 14_DIRECCIÓN_DELASMUJERES.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="9">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/14_DIRECCION_DELASMUJERES.png' %}" alt="Dirección de las Mujeres" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 15_OBRAS_PÚBLICAS.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="10">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/15_OBRAS_PUBLICAS.png' %}" alt="Obras Públicas" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 18_SAPASA.png 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/18_SAPASA.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a> 
        -->
        
        <!-- 19_SECRETARÍA_DEL_AYUNTAMIENTO.png 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/19_SECRETARÍA_DEL_AYUNTAMIENTO.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a> 
        -->
        
        <!-- 24_TESORERÍA_INGRESOS.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="11">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/24_TESORERIA_INGRESOS.png' %}" alt="Tesorería e Ingresos" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 21_TRANSPARENCIA-.png 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/21_TRANSPARENCIA-.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a> 
        -->
        
        <!-- 22_VINCULACIÓN_CIUDADANA.png 
        <a href="#" class="cita-card" data-area="">
            <div class="cita-card-header">
                <img src="{% static 'images/22_VINCULACIÓN_CIUDADANA.png' %}" alt="Dirección Administración" class="cita-card-icon">
            </div>
        </a> 
        -->
        
        <!-- 23_NORMATIVIDAD.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="12">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/23_NORMATIVIDAD.png' %}" alt="Normatividad" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
        
        <!-- 25_CATASTRO.png - CORREGIDO -->
        <div class="cita-card-wrapper">
            <form action="{% url 'Tramites' %}" method="post" class="cita-card-form">
                {% csrf_token %}
                <input type="hidden" name="clave_secreta" value="13">
                <button type="submit" class="cita-card-form-button">
                    <div class="cita-card-header">
                        <img src="{% static 'images/25_CATASTRO.png' %}" alt="Catastro" class="cita-card-icon">
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- Sección de citas recientes -->

<!-- Sección de consulta mejorada -->
<div class="creative-separator">
    <div class="wave-separator"></div>
    <h2 class="separator-text">Consulta tus citas</h2>
</div>

<div class="consulta-citas-section">
    <h3 class="consulta-title">
        <i class="fas fa-calendar-check" style="color: #20a6db;"></i>
        Gestiona tus Citas
    </h3>
    <p class="consulta-description">
        ¿Ya tienes una cita agendada? Consulta su estado, revisa los detalles o cancélala si es necesario. 
        Todo de manera rápida y segura.
    </p>
    <div class="consulta-buttons-container">
        <button id="consultarCitaBtn" class="consulta-button">
            <i class="fas fa-search"></i>
            Consultar Cita
        </button>

    </div>
</div>

<!-- Modal para consultar cita -->
<div id="consultarModal" class="modal-overlay">
    <div class="modal-container">
        <button class="modal-close" id="closeModal">&times;</button>
        <h3 class="modal-title">
            <i class="fas fa-search"></i>
            Consultar Cita
        </h3>
        <p class="modal-subtitle">
            Ingresa el folio de tu cita para consultar su estado y detalles.
        </p>
        <form id="consultarCitaForm" action="{% url 'consultar-cita' %}" method="post">
            {% csrf_token %} 
            <div class="form-group">
                <label for="folio" class="form-label">
                    <i class="fas fa-ticket-alt" style="color: #662392; margin-right: 8px;"></i>
                    Folio de la Cita
                </label>
                <input 
                    type="text" 
                    id="folio" 
                    name="folio" 
                    class="form-input" 
                    placeholder="Ej: CITA-2024-001234"
                    required
                    maxlength="20"
                >
            </div>
            <div class="form-buttons">
                <button type="button" class="btn-secondary" id="cancelarBtn">
                    Cancelar
                </button>
                <button type="submit" class="btn-primary" id="buscarBtn">
                    <i class="fas fa-search"></i>
                    Buscar Cita
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Animación para los pasos - OPTIMIZADA
    document.addEventListener('DOMContentLoaded', function() {
        const pasos = document.querySelectorAll('.paso-item');

        
        // Usar requestAnimationFrame para mejor rendimiento
        const animatePasos = () => {
            pasos.forEach((paso, index) => {
                paso.style.opacity = '0';
                paso.style.transform = 'translateY(20px)';
                paso.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    paso.style.opacity = '1';
                    paso.style.transform = 'translateY(0)';
                }, index * 100);
            });
        };
        
        requestAnimationFrame(animatePasos);
        
        // Efecto hover optimizado para las tarjetas de área
        const cards = document.querySelectorAll('.cita-card, .cita-card-form-button');
        
        cards.forEach(card => {
            let isHovering = false;
            
            card.addEventListener('mouseenter', () => {
                if (!isHovering) {
                    isHovering = true;
                    const icon = card.querySelector('.cita-card-icon');
                    if (icon) {
                        icon.style.transform = 'rotate(2deg) scale(1.02)';
                        icon.style.transition = 'transform 0.2s ease';
                    }
                }
            });
            
            card.addEventListener('mouseleave', () => {
                isHovering = false;
                const icon = card.querySelector('.cita-card-icon');
                if (icon) {
                    icon.style.transform = 'rotate(0) scale(1)';
                }
            });
        });
        
        // Prevenir doble submit en formulario
        const desarrolloSocialForm = document.querySelector('.cita-card-form');
        if (desarrolloSocialForm) {
            let isSubmitting = false;
            
            desarrolloSocialForm.addEventListener('submit', function(e) {
                if (isSubmitting) {
                    e.preventDefault();
                    return false;
                }
                
                isSubmitting = true;
                const button = this.querySelector('.cita-card-form-button');
                if (button) {
                    button.style.opacity = '0.7';
                    button.style.pointerEvents = 'none';
                }
                
                // Resetear después de 3 segundos por si falla el envío
                setTimeout(() => {
                    isSubmitting = false;
                    if (button) {
                        button.style.opacity = '1';
                        button.style.pointerEvents = 'auto';
                    }
                }, 3000);
            });
        }
    });

    // Funcionalidad del modal
document.addEventListener('DOMContentLoaded', function() {
    const consultarBtn = document.getElementById('consultarCitaBtn');
    const modal = document.getElementById('consultarModal');
    const closeBtn = document.getElementById('closeModal');
    const cancelarBtn = document.getElementById('cancelarBtn');
    const form = document.getElementById('consultarCitaForm');
    const folioInput = document.getElementById('folio');
    const buscarBtn = document.getElementById('buscarBtn');

    // Abrir modal
    consultarBtn.addEventListener('click', function() {
        modal.classList.add('active');
        setTimeout(() => folioInput.focus(), 300);
    });

    // Cerrar modal
    function closeModal() {
        modal.classList.remove('active');
        form.reset();
        buscarBtn.disabled = false;
        buscarBtn.innerHTML = '<i class="fas fa-search"></i> Buscar Cita';
    }

    closeBtn.addEventListener('click', closeModal);
    cancelarBtn.addEventListener('click', closeModal);

    // Cerrar modal al hacer clic fuera
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeModal();
        }
    });

    // Cerrar modal con ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    // Validación del formulario
    folioInput.addEventListener('input', function() {
        // Convertir a mayúsculas y limpiar caracteres especiales
        this.value = this.value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
        
 
    });

    // Prevenir doble envío
    folioInput.addEventListener('input', function() {
    // Solo permitir números (eliminar cualquier caracter que no sea número)
    this.value = this.value.replace(/[^0-9]/g, '');
    
    // Opcional: Limitar la longitud máxima si lo deseas
    if (this.value.length > 10) { // Por ejemplo, máximo 10 dígitos
        this.value = this.value.slice(0, 10);
    }
});
});



document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const searchResultsContent = document.getElementById('searchResultsContent');
    const noResults = document.getElementById('noResults');
    const searchLoading = document.getElementById('searchLoading');
    const closeSearch = document.getElementById('closeSearch');
    const resultsCount = document.querySelector('.results-count');
    
    let searchTimeout;
    let currentResults = [];

    // Función para realizar la búsqueda
    function performSearch(query) {
        if (query.length < 2) {
            hideResults();
            return;
        }

        // Mostrar loading
        searchLoading.style.display = 'block';
        
        // Realizar petición AJAX
        fetch('/buscar-tramites/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: `query=${encodeURIComponent(query)}`
        })
        .then(response => response.json())
        .then(data => {
            searchLoading.style.display = 'none';
            
            if (data.results && data.results.length > 0) {
                showResults(data.results, query);
            } else {
                showNoResults();
            }
        })
        .catch(error => {
            console.error('Error en la búsqueda:', error);
            searchLoading.style.display = 'none';
            showNoResults();
        });
    }

    // Función para mostrar resultados
    function showResults(results, query) {
        currentResults = results;
        const html = results.map(tramite => {
            const highlightedTitle = highlightText(tramite.nombre_tramite, query);
            const highlightedDesc = highlightText(tramite.descripcion || '', query);
            
            return `
                <div class="search-result-item" data-tramite-id="${tramite.id_tramite}">
                    <div class="result-title">
                        ${highlightedTitle}
                        <span class="result-area">${tramite.area_nombre}</span>
                    </div>
                    ${highlightedDesc ? `<div class="result-description">${highlightedDesc}</div>` : ''}
                    <div class="result-meta">
                        ${tramite.costo && tramite.costo > 0 ? 
                            `<span class="result-cost">
                                <i class="fas fa-dollar-sign"></i>
                                $${parseFloat(tramite.costo).toFixed(2)}
                            </span>` : 
                            `<span class="result-cost">
                                <i class="fas fa-gift"></i>
                                Gratuito
                            </span>`
                        }
                        ${tramite.tiempo_estimado ? 
                            `<span class="result-time">
                                <i class="far fa-clock"></i>
                                ${tramite.tiempo_estimado}
                            </span>` : ''
                        }
                    </div>
                </div>
            `;
        }).join('');
        
        searchResultsContent.innerHTML = html;
        resultsCount.textContent = `${results.length} resultado${results.length !== 1 ? 's' : ''} encontrado${results.length !== 1 ? 's' : ''}`;
        
        // Mostrar resultados
        noResults.style.display = 'none';
        searchResults.style.display = 'block';
        
        // Agregar event listeners a los resultados
        addResultClickListeners();
    }

    // Función para mostrar mensaje de no resultados
    function showNoResults() {
        searchResults.style.display = 'none';
        noResults.style.display = 'block';
    }

    // Función para ocultar resultados
    function hideResults() {
        searchResults.style.display = 'none';
        noResults.style.display = 'none';
    }

    // Función para resaltar texto coincidente
    function highlightText(text, query) {
        if (!text || !query) return text;
        
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // Función para agregar event listeners a los resultados
    function addResultClickListeners() {
        const resultItems = document.querySelectorAll('.search-result-item');
        
        resultItems.forEach(item => {
            item.addEventListener('click', function() {
                const tramiteId = this.getAttribute('data-tramite-id');
                selectTramite(tramiteId);
            });
        });
    }

    // Función para seleccionar un trámite y enviarlo por POST
    function selectTramite(tramiteId) {
        // Crear y enviar formulario
        const form = document.createElement('form');
        form.method = 'post';
        form.action = '/tramites/cita';
        
        // Token CSRF
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = getCookie('csrftoken');
        form.appendChild(csrfInput);
        
        // ID del trámite
        const tramiteInput = document.createElement('input');
        tramiteInput.type = 'hidden';
        tramiteInput.name = 'cookie';
        tramiteInput.value = tramiteId;
        form.appendChild(tramiteInput);
        
        // Agregar al DOM y enviar
        document.body.appendChild(form);
        form.submit();
    }

    // Función para obtener cookie CSRF
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Event listeners
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        // Limpiar timeout anterior
        clearTimeout(searchTimeout);
        
        // Establecer nuevo timeout para evitar demasiadas peticiones
        searchTimeout = setTimeout(() => {
            performSearch(query);
        }, 300);
    });

    // Cerrar resultados
    closeSearch.addEventListener('click', function() {
        hideResults();
        searchInput.value = '';
        searchInput.blur();
    });

    // Cerrar resultados al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
            hideResults();
        }
    });

    // Manejar teclas especiales
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideResults();
            this.blur();
        }
    });
});

</script>
{% endblock %}